#!/usr/bin/env python3

import os
import sys
import re


coste_list = [330, 337, 361, 362, 370, 380, 421, 463, 467, 511, 850, 922, 923, 933, 974, 979, 1021, 1043, 1055, 1079, 1092, 1130, 1144, 1150, 1173, 1178, 1184, 1198, 1199, 1201, 1323, 1338, 1394, 1397, 1427, 1482, 1511, 1617, 1785, 1881, 2019, 2049, 2199, 2328, 2372, 2492, 2565, 2568, 2576, 2585, 2595, 2596, 2612, 2625, 2674, 2676, 2683, 2684, 2690, 2774, 2804, 2837, 2839, 2850, 2858, 2872, 2873, 2875, 2893, 2907, 2908, 2927, 2944, 2989, 3017, 3091, 3105, 3140, 3144, 3164, 3165, 3263, 3273, 3317, 3330, 3334, 3344, 3351, 3358, 3377, 3385, 3413, 3417, 3534, 3545, 3661, 3831, 3963, 3994, 4052, 4127, 4216, 4289, 4298, 4299, 4318]

#-------------------------------------------------------------------------------
#
#-------------------------------------------------------------------------------
def parse_file(filename):

    fill_coste = 0
    f = open(filename)
    id_tela=""
    for l in f.readlines():
        if re.match("ID.tela",l):
            id_tela = l.split(":")[1].strip()
        if re.match("ID.coste",l):
            try: 
                id_coste = int(l.split(":")[1])
                if id_coste in coste_list:
                    print(filename.split("/")[-1],id_tela,id_coste)
                    g = open("{}.coste".format(id_coste),"w")
                    fill_coste = 1                
            except:
                pass

        if fill_coste:
            g.write(l)


#-------------------------------------------------------------------------------
#
#-------------------------------------------------------------------------------

path = sys.argv[-1]

for root, dirs, files in os.walk(path, topdown=False):
    for name in files:
        if re.match("[A-Z][a-z]+\.[a-z_]+(\-)?[a-z_]*$",name):
            full_filename = os.path.join(root, name)
            parse_file(full_filename)
